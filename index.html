<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Multi-Overlay Previewer</title>
<style>
html,body{height:100%;margin:0;font-family:Inter,system-ui;background:#0b0f1a;color:#e6eef6}
.wrap{max-width:1200px;margin:20px auto;padding:18px;background:#101828;border-radius:12px;box-shadow:0 0 30px rgba(0,0,0,0.4)}
h1{font-size:20px;margin-bottom:12px}
.controls{display:grid;grid-template-columns:320px 1fr;gap:16px}
.panel{background:#0f172a;padding:12px;border-radius:10px}
label{display:block;font-size:13px;margin:8px 0 4px;color:#94a3b8}
input,select,button{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);background:#0b1220;color:inherit}
canvas{background:#0a1320;border-radius:8px;max-width:100%;height:auto;display:block;margin:0 auto;cursor:grab}
.section{border-top:1px solid rgba(255,255,255,0.05);margin-top:10px;padding-top:10px}
</style>
</head>
<body>
<div class="wrap">
<h1>Multi-Overlay Previewer</h1>
<div class="controls">
  <div class="panel">
    <label>Background</label>
    <input id="bgFile" type="file" accept="image/*" />
    <label>or Background URL</label>
    <input id="bgUrl" type="text" placeholder="https://example.com/background.png" />

    <div class="section">
      <h3>Logo Overlay</h3>
      <input id="logoFile" type="file" accept="image/*" />
      <label>or URL</label><input id="logoUrl" type="text" placeholder="https://example.com/logo.png" />
      <label>Scale</label><input id="logoScale" type="range" min="0.1" max="3" step="0.01" value="1" />
      <label>Opacity</label><input id="logoOpacity" type="range" min="0" max="1" step="0.01" value="1" />
    </div>

    <div class="section">
      <h3>Loading Bar Overlay</h3>
      <input id="barFile" type="file" accept="image/*" />
      <label>or URL</label><input id="barUrl" type="text" placeholder="https://example.com/bar.png" />
      <label>Scale</label><input id="barScale" type="range" min="0.1" max="3" step="0.01" value="1" />
      <label>Opacity</label><input id="barOpacity" type="range" min="0" max="1" step="0.01" value="1" />
    </div>

    <div class="section">
      <h3>Text Overlay</h3>
      <label>Text Content</label><input id="textInput" type="text" placeholder="Enter your text" />
      <label>Font</label>
      <select id="textFont">
        <option value="Arial, sans-serif">Arial</option>
        <option value="'Times New Roman', serif">Times New Roman</option>
        <option value="'Courier New', monospace">Courier New</option>
        <option value="'Poppins', sans-serif">Poppins</option>
        <option value="'Roboto', sans-serif">Roboto</option>
        <option value="'Pacifico', cursive">Pacifico</option>
      </select>
      <label>Text Color</label><input type="color" id="textColor" value="#ffffff" />
      <label>or Text Image</label><input id="textFile" type="file" accept="image/*" />
      <label>or URL</label><input id="textUrl" type="text" placeholder="https://example.com/text.png" />
      <label>Scale</label><input id="textScale" type="range" min="0.1" max="3" step="0.01" value="1" />
      <label>Opacity</label><input id="textOpacity" type="range" min="0" max="1" step="0.01" value="1" />
    </div>

    <div class="section">
      <button id="download">Download Combined PNG</button>
    </div>
  </div>

  <div class="panel">
    <canvas id="canvas"></canvas>
  </div>
</div>
</div>

<script>
const canvas=document.getElementById('canvas');
const ctx=canvas.getContext('2d');
let bgImg=null;
let textImg=null;
let overlays={
  logo:{img:null,x:100,y:100,scale:1,opacity:1},
  bar:{img:null,x:100,y:400,scale:1,opacity:1},
  text:{img:null,x:100,y:500,scale:1,opacity:1}
};
let dragging=null;
let dragOffset={x:0,y:0};

function loadImage(src,cb){
  const i=new Image();
  i.crossOrigin="anonymous";
  i.onload=()=>cb(i);
  i.onerror=()=>alert("Failed to load image: "+src);
  i.src=src;
}

function fileToImage(file,cb){
  const r=new FileReader();
  r.onload=()=>loadImage(r.result,cb);
  r.readAsDataURL(file);
}

function resizeCanvasToImage(img){
  const maxW=1024;
  const scale=Math.min(maxW/img.width,1);
  canvas.width=img.width*scale;
  canvas.height=img.height*scale;
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  if(bgImg) ctx.drawImage(bgImg,0,0,canvas.width,canvas.height);

  ['logo','bar'].forEach(key=>{
    const o=overlays[key];
    if(o.img){
      ctx.save();
      ctx.globalAlpha=o.opacity;
      const w=o.img.width*o.scale,h=o.img.height*o.scale;
      ctx.drawImage(o.img,o.x,o.y,w,h);
      ctx.restore();
    }
  });

  const t=overlays.text;
  if(textImg){
    ctx.save();
    ctx.globalAlpha=t.opacity;
    const w=textImg.width*t.scale,h=textImg.height*t.scale;
    ctx.drawImage(textImg,t.x,t.y,w,h);
    ctx.restore();
  } else {
    const txt=document.getElementById('textInput').value;
    if(txt){
      ctx.save();
      ctx.globalAlpha=t.opacity;
      ctx.font=`${50*t.scale}px ${document.getElementById('textFont').value}`;
      ctx.fillStyle=document.getElementById('textColor').value;
      ctx.textBaseline='top';
      ctx.fillText(txt,t.x,t.y);
      ctx.restore();
    }
  }
}

// Background
bgFile.onchange=e=>{const f=e.target.files[0]; if(!f) return; fileToImage(f,img=>{bgImg=img; resizeCanvasToImage(img); draw();});};
bgUrl.onchange=e=>{const url=e.target.value.trim(); if(!url) return; loadImage(url,img=>{bgImg=img; resizeCanvasToImage(img); draw();});};

// Logo & Bar
['logo','bar'].forEach(name=>{
  const fileInput=document.getElementById(name+'File');
  const urlInput=document.getElementById(name+'Url');
  fileInput.addEventListener('change',e=>{const f=e.target.files[0]; if(!f) return; fileToImage(f,img=>{overlays[name].img=img; draw();});});
  urlInput.addEventListener('change',e=>{const url=e.target.value.trim(); if(!url) return; loadImage(url,img=>{overlays[name].img=img; draw();});});
  document.getElementById(name+'Scale').addEventListener('input',e=>{overlays[name].scale=parseFloat(e.target.value); draw();});
  document.getElementById(name+'Opacity').addEventListener('input',e=>{overlays[name].opacity=parseFloat(e.target.value); draw();});
});

// Text Image
textFile.onchange=e=>{const f=e.target.files[0]; if(!f) return; fileToImage(f,img=>{textImg=img; draw();});};
textUrl.onchange=e=>{const url=e.target.value.trim(); if(!url) return; loadImage(url,img=>{textImg=img; draw();});};
textScale.addEventListener('input',e=>{overlays.text.scale=parseFloat(e.target.value); draw();});
textOpacity.addEventListener('input',e=>{overlays.text.opacity=parseFloat(e.target.value); draw();});
textInput.addEventListener('input',draw);
textFont.addEventListener('change',draw);
textColor.addEventListener('input',draw);

// Dragging overlays
canvas.addEventListener('mousedown', e=>{
  const rect=canvas.getBoundingClientRect();
  const x=e.clientX-rect.left, y=e.clientY-rect.top;

  for(const key of ['logo','bar','text']){
    const o=overlays[key];
    let w,h;
    if(key==='text'){
      if(textImg){ w=textImg.width*o.scale; h=textImg.height*o.scale; }
      else {
        const txt=document.getElementById('textInput').value;
        if(!txt) continue;
        ctx.font=`${50*o.scale}px ${document.getElementById('textFont').value}`;
        w=ctx.measureText(txt).width; h=50*o.scale;
      }
    } else { if(!o.img) continue; w=o.img.width*o.scale; h=o.img.height*o.scale; }

    if(x>=o.x && x<=o.x+w && y>=o.y && y<=o.y+h){
      dragging=key; dragOffset={x:x-o.x,y:y-o.y};
      canvas.style.cursor="grabbing"; return;
    }
  }
});
window.addEventListener('mousemove',e=>{
  if(!dragging) return;
  const rect=canvas.getBoundingClientRect();
  const x=e.clientX-rect.left, y=e.clientY-rect.top;
  const o=overlays[dragging];
  o.x=x-dragOffset.x; o.y=y-dragOffset.y;
  draw();
});
window.addEventListener('mouseup',()=>{dragging=null; canvas.style.cursor="grab";});

// Scrollwheel scaling
canvas.addEventListener('wheel',e=>{
  const rect=canvas.getBoundingClientRect();
  const x=e.clientX-rect.left, y=e.clientY-rect.top;
  for(const key of ['logo','bar','text']){
    const o=overlays[key];
    let w,h;
    if(key==='text'){
      if(textImg){ w=textImg.width*o.scale; h=textImg.height*o.scale; }
      else {
        const txt=document.getElementById('textInput').value;
        if(!txt) continue;
        ctx.font=`${50*o.scale}px ${document.getElementById('textFont').value}`;
        w=ctx.measureText(txt).width; h=50*o.scale;
      }
    } else { if(!o.img) continue; w=o.img.width*o.scale; h=o.img.height*o.scale; }

    if(x>=o.x && x<=o.x+w && y>=o.y && y<=o.y+h){
      e.preventDefault();
      o.scale=Math.max(0.1,o.scale+(e.deltaY<0?0.05:-0.05));
      document.getElementById(key+'Scale').value=o.scale.toFixed(2);
      draw(); return;
    }
  }
},{passive:false});

// Download
download.onclick=()=>{const link=document.createElement('a'); link.download='combined.png'; link.href=canvas.toDataURL('image/png'); link.click();};
</script>
</body>
</html>
